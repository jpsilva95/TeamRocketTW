// ==UserScript==
// @name         Mystery Dailies Obfuscated
// @namespace    http://tampermonkey.net/
// @version      3.2
// @description  Send daily farm, resource stats, and troop counts to Discord
// @author       Mystery Inc.
// @match        https://*.tribalwars.com.pt/game.php*
// @match        https://*.tribalwars.net/game.php*
// @match        https://*.tribalwars.com/game.php*
// @match        https://*.tribalwars.co.uk/game.php*
// @grant        GM_xmlhttpRequest
// @connect      discord.com
// ==/UserScript==

(function(){var _0x1a2b='use strict';var _0xVER='2.9';var _0xVKEY='tw_script_version';var _0xLAST=localStorage.getItem(_0xVKEY);if(_0xLAST!==_0xVER){console.log('New script version:',_0xVER,'(was:',_0xLAST,')');localStorage.setItem(_0xVKEY,_0xVER);localStorage.removeItem('tw_daily_sent_marker');localStorage.removeItem('tw_daily_sending_marker');localStorage.removeItem('tw_daily_intent_marker');console.log('Version updated - cache cleared!');}var _0x3c4d=function(){if(document.getElementById('trDailiesBtn'))return;var _0x5e6f=document.querySelector('.questlog, #questlog_new, [id*="questlog"]');if(_0x5e6f){var _0x7g8h=document.createElement('div');_0x7g8h.style.cssText='margin-top: 5px; text-align: center;';var _0x9i0j=document.createElement('button');_0x9i0j.id='trDailiesBtn';_0x9i0j.innerHTML='<img src="https://i.ibb.co/x8JQX8yS/ex1.png" style="width: 45px; height: 45px;">';_0x9i0j.title='Daily Stats to Discord';_0x9i0j.style.cssText='width: 40px; height: 40px; background: transparent; border: none; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; padding: 0;';_0x9i0j.onclick=function(_0x1k2l){_0x1k2l.preventDefault();_0x3m4n();};_0x7g8h.appendChild(_0x9i0j);_0x5e6f.appendChild(_0x7g8h);}else{var _0x5o6p=document.querySelector('#header_info');if(_0x5o6p){var _0x7q8r=document.createElement('a');_0x7q8r.id='trDailiesBtn';_0x7q8r.href='#';_0x7q8r.innerHTML='<img src="https://i.ibb.co/x8JQX8yS/ex1.png" style="width: 20px; height: 20px; vertical-align: middle;">';_0x7q8r.title='Daily Stats';_0x7q8r.style.cssText='margin-left: 10px; padding: 5px; background: transparent; border: none; text-decoration: none; display: inline-block;';_0x7q8r.onclick=function(_0x9s0t){_0x9s0t.preventDefault();_0x3m4n();};_0x5o6p.appendChild(_0x7q8r);}}};var _0x3m4n=function(){var _0x1u2v=document.createElement('div');_0x1u2v.style.cssText='position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; display: flex; align-items: center; justify-content: center;';var _0x3w4x=document.createElement('div');_0x3w4x.style.cssText='background: #2C2F33; color: #DCDDDE; padding: 25px; border-radius: 8px; width: 550px; box-shadow: 0 8px 16px rgba(0,0,0,0.3);';_0x3w4x.innerHTML='<h2 style="margin-top: 0; color: #5865F2;">üìä Send Daily Stats to Discord</h2><div style="margin-bottom: 15px;"><label style="display: block; margin-bottom: 5px; font-weight: bold;">Discord Webhook URL:</label><input type="text" id="webhookUrl" placeholder="https://discord.com/api/webhooks/..." style="width: 100%; padding: 8px; border: 1px solid #40444B; background: #40444B; color: #DCDDDE; border-radius: 4px; box-sizing: border-box;"></div><div style="margin-bottom: 15px;"><label style="display: block; margin-bottom: 5px;"><input type="checkbox" id="autoSendEnabled" style="margin-right: 5px;"><strong>Auto-send daily at:</strong></label><input type="time" id="autoSendTime" value="23:00" disabled style="width: 100%; padding: 8px; border: 1px solid #40444B; background: #40444B; color: #DCDDDE; border-radius: 4px; box-sizing: border-box;"><p style="font-size: 12px; color: #B9BBBE; margin: 5px 0 0 0;">Leave the game open for auto-send to work</p></div><div id="statsPreview" style="background: #40444B; padding: 15px; border-radius: 4px; margin-bottom: 15px;"><p style="margin: 5px 0;"><strong>Gathering stats...</strong></p></div><div style="display: flex; gap: 10px;"><button id="sendBtn" style="flex: 1; padding: 10px; background: #5865F2; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: bold;">Send to Discord</button><button id="closeBtn" style="flex: 1; padding: 10px; background: #ED4245; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: bold;">Close</button></div><div id="statusMsg" style="margin-top: 15px; text-align: center; font-size: 14px;"></div>';_0x1u2v.appendChild(_0x3w4x);document.body.appendChild(_0x1u2v);var _0x5y6z=localStorage.getItem('tw_discord_webhook');var _0x7a8b=localStorage.getItem('tw_auto_send_enabled')==='true';var _0x9c0d=localStorage.getItem('tw_auto_send_time')||'23:00';if(_0x5y6z){document.getElementById('webhookUrl').value=_0x5y6z;}var _0x1e2f=document.getElementById('autoSendEnabled');var _0x3g4h=document.getElementById('autoSendTime');_0x1e2f.checked=_0x7a8b;_0x3g4h.value=_0x9c0d;_0x3g4h.disabled=!_0x7a8b;_0x1e2f.onchange=function(){_0x3g4h.disabled=!_0x1e2f.checked;localStorage.setItem('tw_auto_send_enabled',_0x1e2f.checked);if(_0x1e2f.checked){localStorage.setItem('tw_auto_send_time',_0x3g4h.value);_0x5i6j();}};_0x3g4h.onchange=function(){localStorage.setItem('tw_auto_send_time',_0x3g4h.value);if(_0x1e2f.checked){_0x5i6j();}};var _0x7k8l=document.getElementById('statsPreview');_0x7k8l.innerHTML='<p style="margin: 5px 0;"><strong>Loading stats (this may take a few seconds)...</strong></p>';_0x9m0n().then(function(_0x1o2p){console.log('Stats gathered:',_0x1o2p);var _0x3q4r='';if(Object.keys(_0x1o2p.troopsHome).length>0){_0x3q4r='<p style="margin: 10px 0 5px 0; border-top: 1px solid #2C2F33; padding-top: 10px;"><strong>‚öîÔ∏è Total Troops at Home:</strong></p>';for(var _0x5s6t in _0x1o2p.troopsHome){var _0x7u8v=_0x1o2p.troopsHome[_0x5s6t];var _0x9w0x=typeof _0x7u8v.count==='number'?_0x7u8v.count:_0xaa1b(_0x7u8v.count.toString());if(_0x9w0x===0)continue;var _0x1y2z=_0x7u8v.icon?'<img src="'+_0x7u8v.icon+'" style="width: 18px; height: 18px; vertical-align: middle; margin-right: 4px;">':'';_0x3q4r+='<p style="margin: 2px 0; padding-left: 20px; font-size: 13px;">'+_0x1y2z+_0x5s6t+': '+_0x7u8v.count+'</p>';}}var _0x3a4b='';if(Object.keys(_0x1o2p.troopsScavenging).length>0){_0x3a4b='<p style="margin: 10px 0 5px 0; border-top: 1px solid #2C2F33; padding-top: 10px;"><strong>üîç Total Troops Scavenging:</strong></p>';for(var _0x5c6d in _0x1o2p.troopsScavenging){var _0x7e8f=_0x1o2p.troopsScavenging[_0x5c6d];var _0x9g0h=typeof _0x7e8f.count==='number'?_0x7e8f.count:_0xaa1b(_0x7e8f.count.toString());if(_0x9g0h===0)continue;var _0x1i2j=_0x7e8f.icon?'<img src="'+_0x7e8f.icon+'" style="width: 18px; height: 18px; vertical-align: middle; margin-right: 4px;">':'';_0x3a4b+='<p style="margin: 2px 0; padding-left: 20px; font-size: 13px;">'+_0x1i2j+_0x5c6d+': '+_0x7e8f.count+'</p>';}}if(_0x1o2p.playerName&&_0x1o2p.playerName!=='Unknown'){var _0x3k4l=document.getElementById('webhookUrl').value.trim();if(_0x3k4l){var _0x5m6n=_0x3k4l.split('/').pop();var _0x7o8p='tw_player_name_'+_0x1o2p.world+'_'+_0x5m6n;localStorage.setItem(_0x7o8p,_0x1o2p.playerName);}}var _0x9q0r='';if(_0x1o2p.playerName==='Unknown'){_0x9q0r='<div style="margin: 10px 0; padding: 10px; background: #ED4245; border-radius: 4px;"><p style="margin: 0 0 5px 0; font-size: 12px; color: white;"><strong>‚ö†Ô∏è Player name not detected</strong></p><input type="text" id="manualPlayerName" placeholder="Enter your player name" style="width: 100%; padding: 6px; border: 1px solid #40444B; background: #40444B; color: #DCDDDE; border-radius: 4px; box-sizing: border-box; font-size: 13px;"></div>';}_0x7k8l.innerHTML='<p style="margin: 5px 0;"><strong>üåç World:</strong> '+_0x1o2p.world+'</p><p style="margin: 5px 0;"><strong>üë§ Player:</strong> '+_0x1o2p.playerName+'</p>'+_0x9q0r+'<p style="margin: 5px 0;"><strong>üåæ Daily Farm Total:</strong> '+_0x1o2p.farmTotal+'</p><p style="margin: 5px 0;"><strong>üì¶ Daily Resources Total:</strong> '+_0x1o2p.gatherTotal+'</p><p style="margin: 10px 0 5px 0; border-top: 1px solid #2C2F33; padding-top: 10px;"><strong>üí∞ Grand Total:</strong> '+_0x1o2p.grandTotal+'</p>'+_0x3q4r+_0x3a4b;}).catch(function(_0x1s2t){_0x7k8l.innerHTML='<p style="margin: 5px 0; color: #ED4245;"><strong>Error loading stats. Please try again.</strong></p>';console.error('Error gathering stats:',_0x1s2t);});document.getElementById('closeBtn').onclick=function(){document.body.removeChild(_0x1u2v);};document.getElementById('sendBtn').onclick=async function(){var _0x3u4v=document.getElementById('webhookUrl').value.trim();var _0x5w6x=document.getElementById('statusMsg');if(!_0x3u4v){_0x5w6x.innerHTML='<span style="color: #ED4245;">‚ùå Please enter a webhook URL</span>';return;}if(this.disabled)return;this.disabled=true;this.style.opacity='0.5';localStorage.setItem('tw_discord_webhook',_0x3u4v);_0x5w6x.innerHTML='<span style="color: #FEE75C;">‚è≥ Sending...</span>';var _0x7y8z=await _0x9m0n();var _0x9a0b=document.getElementById('manualPlayerName');if(_0x9a0b&&_0x9a0b.value.trim()){_0x7y8z.playerName=_0x9a0b.value.trim();var _0x1c2d=_0x3u4v.split('/').pop();var _0x3e4f='tw_player_name_'+_0x7y8z.world+'_'+_0x1c2d;localStorage.setItem(_0x3e4f,_0x7y8z.playerName);}var _0xself=this;_0x5g6h(_0x3u4v,_0x7y8z,{innerHTML:function(msg){_0x5w6x.innerHTML=msg;_0xself.disabled=false;_0xself.style.opacity='1';}});};_0x1u2v.onclick=function(_0x7i8j){if(_0x7i8j.target===_0x1u2v){document.body.removeChild(_0x1u2v);}};};var _0xaa1b=function(_0xbb2c){if(!_0xbb2c)return 0;var _0xcc3d=_0xbb2c.replace(/\s/g,'').replace(/\./g,'').replace(/[^\d]/g,'');return parseInt(_0xcc3d)||0;};var _0xdd4e=function(_0xee5f){return _0xee5f.toLocaleString('pt-PT');};async function _0x9m0n(){var _0xff6g={farmResources:{wood:'N/A',clay:'N/A',iron:'N/A'},gatherResources:{wood:'N/A',clay:'N/A',iron:'N/A'},farmTotal:'N/A',gatherTotal:'N/A',grandTotal:'N/A',playerName:'Unknown',troopsHome:{},troopsScavenging:{},world:'Unknown'};try{var _0x007h=window.location.origin+window.location.pathname;var _0x118i=new URLSearchParams(window.location.search);var _0x229j=window.location.hostname.match(/^(\w+)\./);_0xff6g.world=_0x229j?_0x229j[1].toUpperCase():'Unknown';var _0x330k=await fetch(_0x007h+'?'+_0x118i.toString()+'&screen=info_player');var _0x441l=await _0x330k.text();var _0x552m=new DOMParser().parseFromString(_0x441l,'text/html');var _0x663n=_0x552m.querySelector('td.selected a[href*="screen=info_player"]');if(_0x663n){_0xff6g.playerName=_0x663n.textContent.trim();}if(_0xff6g.playerName==='Unknown'||!_0xff6g.playerName){var _0x774o=_0x552m.querySelector('table.vis.modemenu td.selected a');if(_0x774o){_0xff6g.playerName=_0x774o.textContent.trim();}}if(_0xff6g.playerName==='Unknown'||!_0xff6g.playerName){var _0x885p=document.querySelector('#menu_row2 a[href*="screen=info_player"]:not([href*="id="])');if(_0x885p){_0xff6g.playerName=_0x885p.textContent.trim();}}if(_0xff6g.playerName==='Unknown'||!_0xff6g.playerName){var _0x996q=document.querySelector('#menu_row2');if(_0x996q){var _0xaa7r=_0x996q.querySelectorAll('a[href*="screen=info_player"]:not([href*="id="])');if(_0xaa7r.length>0){_0xff6g.playerName=_0xaa7r[0].textContent.trim();}}}var _0xbb8s=await fetch(_0x007h+'?'+_0x118i.toString()+'&screen=ranking&mode=in_a_day&type=loot_res');var _0xcc9t=await _0xbb8s.text();var _0xdd0u=new DOMParser().parseFromString(_0xcc9t,'text/html');var _0xee1v=_0xdd0u.querySelector('#content_value');if(_0xee1v){var _0xff2w=_0xee1v.textContent;var _0x003x=_0xff2w.match(/O\s+meu\s+resultado\s+de\s+hoje:\s*([\d\s\.]+)/i);if(_0x003x){var _0x114y=_0xaa1b(_0x003x[1]);_0xff6g.farmTotal=_0xdd4e(_0x114y);var _0x225z=_0xdd0u.querySelector('#in_a_day_ranking_table tr.lit, #in_a_day_ranking_table tr.lit-item');if(_0x225z){var _0x336a=_0x225z.querySelectorAll('td');if(_0x336a.length>=5){_0xff6g.farmResources.wood=_0xdd4e(_0xaa1b(_0x336a[2]?_0x336a[2].textContent:'0'));_0xff6g.farmResources.clay=_0xdd4e(_0xaa1b(_0x336a[3]?_0x336a[3].textContent:'0'));_0xff6g.farmResources.iron=_0xdd4e(_0xaa1b(_0x336a[4]?_0x336a[4].textContent:'0'));}}}}var _0x447b=await fetch(_0x007h+'?'+_0x118i.toString()+'&screen=ranking&mode=in_a_day&type=scavenge');var _0x558c=await _0x447b.text();var _0x669d=new DOMParser().parseFromString(_0x558c,'text/html');var _0x770e=_0x669d.querySelector('#content_value');if(_0x770e){var _0x881f=_0x770e.textContent;var _0x992g=_0x881f.match(/O\s+meu\s+resultado\s+de\s+hoje:\s*([\d\s\.]+)/i);if(_0x992g){var _0xaa3h=_0xaa1b(_0x992g[1]);_0xff6g.gatherTotal=_0xdd4e(_0xaa3h);var _0xbb4i=_0x669d.querySelector('#in_a_day_ranking_table tr.lit, #in_a_day_ranking_table tr.lit-item');if(_0xbb4i){var _0xcc5j=_0xbb4i.querySelectorAll('td');if(_0xcc5j.length>=5){_0xff6g.gatherResources.wood=_0xdd4e(_0xaa1b(_0xcc5j[2]?_0xcc5j[2].textContent:'0'));_0xff6g.gatherResources.clay=_0xdd4e(_0xaa1b(_0xcc5j[3]?_0xcc5j[3].textContent:'0'));_0xff6g.gatherResources.iron=_0xdd4e(_0xaa1b(_0xcc5j[4]?_0xcc5j[4].textContent:'0'));}}}}if(_0xff6g.gatherTotal!=='N/A'&&_0xff6g.farmTotal!=='N/A'){var _0xdd6k=_0xaa1b(_0xff6g.gatherTotal);var _0xee7l=_0xaa1b(_0xff6g.farmTotal);_0xff6g.grandTotal=_0xdd4e(_0xdd6k+_0xee7l);}var _0xff8m='https://dspt.innogamescdn.com/asset/caf5a096/graphic/unit/';var _0x009n={'spear':'Spear','sword':'Sword','axe':'Axe','archer':'Archer','spy':'Spy','light':'Light Cav','marcher':'Mounted Archer','heavy':'Heavy Cav','ram':'Ram','catapult':'Catapult','knight':'Paladin','snob':'Noble'};try{var _0x110o=0;var _0x221p=false;var _0x332q=false;console.log('Starting to fetch scavenge data...');while(!_0x221p&&_0x110o<20){var _0x443r=_0x007h+'?'+_0x118i.toString()+'&screen=place&mode=scavenge_mass&page='+_0x110o;console.log('Fetching page',_0x110o);var _0x554s=await fetch(_0x443r);var _0x665t=await _0x554s.text();var _0x776u=_0x665t.match(/ScavengeMassScreen[\s\S]*?(,\n *\[.*?\}{0,3}\],\n)/);if(!_0x776u||_0x776u.length<=1){console.log('No match found on page',_0x110o);break;}var _0x887v=_0x776u[1];_0x887v=_0x887v.substring(_0x887v.indexOf('['));_0x887v=_0x887v.substring(0,_0x887v.length-2);var _0x998w=JSON.parse(_0x887v);console.log('Page',_0x110o,'has',_0x998w.length,'villages');if(_0x998w.length===0){_0x221p=true;break;}_0x998w.forEach(function(_0xaa9x){if(!_0x332q&&_0xaa9x.player_name){_0xff6g.playerName=_0xaa9x.player_name;_0x332q=true;}if(_0xaa9x.unit_counts_home){Object.entries(_0xaa9x.unit_counts_home).forEach(function(_0xbb0y){var _0xcc1z=_0xbb0y[0];var _0xdd2a=_0xbb0y[1];if(_0xcc1z!=='militia'&&_0x009n[_0xcc1z]){var _0xee3b=_0x009n[_0xcc1z];if(!_0xff6g.troopsHome[_0xee3b]){_0xff6g.troopsHome[_0xee3b]={count:0,icon:_0xff8m+'unit_'+_0xcc1z+'.png'};}_0xff6g.troopsHome[_0xee3b].count+=_0xdd2a;}});}if(_0xaa9x.options){Object.values(_0xaa9x.options).forEach(function(_0xff4c){if(_0xff4c.scavenging_squad&&_0xff4c.scavenging_squad.unit_counts){Object.entries(_0xff4c.scavenging_squad.unit_counts).forEach(function(_0x005d){var _0x116e=_0x005d[0];var _0x227f=_0x005d[1];if(_0x116e!=='militia'&&_0x009n[_0x116e]){var _0x338g=_0x009n[_0x116e];if(!_0xff6g.troopsScavenging[_0x338g]){_0xff6g.troopsScavenging[_0x338g]={count:0,icon:_0xff8m+'unit_'+_0x116e+'.png'};}_0xff6g.troopsScavenging[_0x338g].count+=_0x227f;}});}});}});_0x110o++;await new Promise(function(_0x449h){return setTimeout(_0x449h,300);});}console.log('Finished fetching scavenge data. Total pages:',_0x110o);console.log('Troops home:',_0xff6g.troopsHome);console.log('Troops scavenging:',_0xff6g.troopsScavenging);if(_0xff6g.playerName==='Unknown'||!_0xff6g.playerName){if(typeof game_data!=='undefined'&&game_data.player&&game_data.player.name){_0xff6g.playerName=game_data.player.name;}else{try{var _0x550i=await fetch(_0x007h+'?'+_0x118i.toString()+'&screen=info_player');var _0x661j=await _0x550i.text();var _0x772k=new DOMParser().parseFromString(_0x661j,'text/html');var _0x883l=_0x772k.querySelector('td.selected a[href*="screen=info_player"]');if(_0x883l){_0xff6g.playerName=_0x883l.textContent.trim();}if(_0xff6g.playerName==='Unknown'||!_0xff6g.playerName){var _0x994m=_0x772k.querySelector('table.vis.modemenu td.selected a');if(_0x994m){_0xff6g.playerName=_0x994m.textContent.trim();}}}catch(_0xaa5n){console.error('Error fetching player name:',_0xaa5n);}}}for(var _0xbb6o in _0xff6g.troopsHome){_0xff6g.troopsHome[_0xbb6o].count=_0xdd4e(_0xff6g.troopsHome[_0xbb6o].count);}for(var _0xcc7p in _0xff6g.troopsScavenging){_0xff6g.troopsScavenging[_0xcc7p].count=_0xdd4e(_0xff6g.troopsScavenging[_0xcc7p].count);}}catch(_0xdd8q){console.error('Error fetching troop data:',_0xdd8q);}}catch(_0xee9r){console.log('Error gathering stats:',_0xee9r);}return _0xff6g;}function _0x5g6h(_0xff0s,_0x001t,_0x112u){var _0x223v=[{name:'Player',value:'üë§ '+(_0x001t.playerName||'Unknown'),inline:false},{name:'World',value:'üåç '+(_0x001t.world||'Unknown'),inline:false},{name:'Daily Farm Total',value:'üåæ '+(_0x001t.farmTotal||'0'),inline:true},{name:'Daily Resources Total',value:'üì¶ '+(_0x001t.gatherTotal||'0'),inline:true},{name:'Grand Total',value:'üí∞ '+(_0x001t.grandTotal||'0'),inline:false}];if(Object.keys(_0x001t.troopsHome).length>0){var _0x334w='';for(var _0x445x in _0x001t.troopsHome){var _0x556y=typeof _0x001t.troopsHome[_0x445x].count==='string'?_0xaa1b(_0x001t.troopsHome[_0x445x].count):_0x001t.troopsHome[_0x445x].count;if(_0x556y===0)continue;_0x334w+=_0x445x+': '+_0x001t.troopsHome[_0x445x].count+'\n';}if(_0x334w.trim().length>0&&_0x334w.trim().length<1024){_0x223v.push({name:'Troops at Home',value:'‚öîÔ∏è '+_0x334w.trim(),inline:false});}}if(Object.keys(_0x001t.troopsScavenging).length>0){var _0x667z='';for(var _0x778a in _0x001t.troopsScavenging){var _0x889b=typeof _0x001t.troopsScavenging[_0x778a].count==='string'?_0xaa1b(_0x001t.troopsScavenging[_0x778a].count):_0x001t.troopsScavenging[_0x778a].count;if(_0x889b===0)continue;_0x667z+=_0x778a+': '+_0x001t.troopsScavenging[_0x778a].count+'\n';}if(_0x667z.trim().length>0&&_0x667z.trim().length<1024){_0x223v.push({name:'Troops Scavenging',value:'üîç '+_0x667z.trim(),inline:false});}}var _0x990c={title:'üìä Tribal Wars Daily Report',color:5814783,fields:_0x223v,timestamp:new Date().toISOString(),footer:{text:'Mystery Bot'}};var _0xaa1d=JSON.stringify({embeds:[_0x990c]});console.log('Sending payload:',_0xaa1d);if(typeof GM_xmlhttpRequest!=='undefined'){GM_xmlhttpRequest({method:'POST',url:_0xff0s,headers:{'Content-Type':'application/json'},data:_0xaa1d,onload:function(_0xbb2e){if(_0xbb2e.status===204){_0x112u.innerHTML='<span style="color: #57F287;">‚úÖ Successfully sent to Discord!</span>';}else{_0x112u.innerHTML='<span style="color: #ED4245;">‚ùå Error: '+_0xbb2e.status+'</span>';console.error('Discord response:',_0xbb2e.responseText);}},onerror:function(_0xcc3e){_0x112u.innerHTML='<span style="color: #ED4245;">‚ùå Failed to send. Check your webhook URL.</span>';console.error('Request error:',_0xcc3e);}});}else{fetch(_0xff0s,{method:'POST',headers:{'Content-Type':'application/json'},body:_0xaa1d,mode:'no-cors'}).then(function(){_0x112u.innerHTML='<span style="color: #57F287;">‚úÖ Sent to Discord!</span>';}).catch(function(_0xdd4g){_0x112u.innerHTML='<span style="color: #ED4245;">‚ùå Failed to send. Check your webhook URL.</span>';console.error('Error:',_0xdd4g);});}}function _0x5i6j(){var _0xee5h=localStorage.getItem('tw_auto_send_enabled')==='true';var _0xff6i=localStorage.getItem('tw_auto_send_time')||'23:00';var _0x007j=localStorage.getItem('tw_discord_webhook');if(!_0xee5h||!_0x007j)return;var _0x118k='tab_'+Date.now()+'_'+Math.random().toString(36).substr(2,9);var _0x229l=false;window.addEventListener('storage',function(_0x330m){if(_0x330m.key==='tw_daily_sent_marker'||_0x330m.key==='tw_daily_sending_marker'||_0x330m.key==='tw_daily_intent_marker'){_0x229l=true;}});var _0x441n=async function(){_0x229l=false;var _0x552o=new Date();var _0x663p=String(_0x552o.getHours()).padStart(2,'0')+':'+String(_0x552o.getMinutes()).padStart(2,'0');var _0x774q=_0x552o.toDateString();var _0x885r=_0x774q+'_'+_0xff6i;if(_0x663p!==_0xff6i)return;var _0x996s='tw_daily_sent_marker';var _0xaa7t='tw_daily_sending_marker';var _0xbb8u='tw_daily_intent_marker';if(localStorage.getItem(_0x996s)===_0x885r){console.log('Already sent today, skipping');return;}var _0xcc9v=localStorage.getItem(_0xbb8u);if(_0xcc9v){try{var _0xdd0w=JSON.parse(_0xcc9v);if(_0xdd0w.key===_0x885r&&(Date.now()-_0xdd0w.timestamp)<15000){console.log('Another tab has intent, backing off');return;}}catch(_0xee1x){}}var _0xff2w=localStorage.getItem(_0xaa7t);if(_0xff2w){try{var _0x003x=JSON.parse(_0xff2w);if(_0x003x.key===_0x885r&&(Date.now()-_0x003x.timestamp)<90000){console.log('Another tab is sending, backing off');return;}}catch(_0x114y){}}var _0x225z=Date.now()+Math.random();var _0x336a={key:_0x885r,tabId:_0x118k,nonce:_0x225z,timestamp:Date.now()};localStorage.setItem(_0xbb8u,JSON.stringify(_0x336a));await new Promise(function(_0x447b){return setTimeout(_0x447b,100);});if(_0x229l)return;var _0x558c=localStorage.getItem(_0xbb8u);if(!_0x558c)return;try{var _0x669d=JSON.parse(_0x558c);if(_0x669d.nonce!==_0x225z){console.log('Lost intent race, backing off');return;}}catch(_0x770e){return;}if(localStorage.getItem(_0x996s)===_0x885r){localStorage.removeItem(_0xbb8u);return;}var _0x881f=Math.floor(Math.random()*500);await new Promise(function(_0x992g){return setTimeout(_0x992g,_0x881f);});if(_0x229l){localStorage.removeItem(_0xbb8u);return;}if(localStorage.getItem(_0x996s)===_0x885r){localStorage.removeItem(_0xbb8u);return;}var _0xaa3h={key:_0x885r,tabId:_0x118k,nonce:_0x225z,timestamp:Date.now()};localStorage.setItem(_0xaa7t,JSON.stringify(_0xaa3h));await new Promise(function(_0xbb4i){return setTimeout(_0xbb4i,200);});if(_0x229l){localStorage.removeItem(_0xbb8u);localStorage.removeItem(_0xaa7t);return;}var _0xcc5j=localStorage.getItem(_0xaa7t);if(!_0xcc5j){localStorage.removeItem(_0xbb8u);return;}try{var _0xdd6k=JSON.parse(_0xcc5j);if(_0xdd6k.nonce!==_0x225z){console.log('Lost sending race, backing off');localStorage.removeItem(_0xbb8u);return;}}catch(_0xee7l){localStorage.removeItem(_0xbb8u);return;}if(localStorage.getItem(_0x996s)===_0x885r){localStorage.removeItem(_0xbb8u);localStorage.removeItem(_0xaa7t);return;}localStorage.setItem(_0x996s,_0x885r);localStorage.setItem('tw_last_auto_send',_0x774q);localStorage.setItem('tw_last_auto_send_time',_0xff6i);console.log('This tab won the race, sending now');try{var _0xff8m=await _0x9m0n();if(_0x229l)return;if(_0xff8m.playerName==='Unknown'||!_0xff8m.playerName){var _0x009n=_0x007j.split('/').pop();var _0x110o='tw_player_name_'+_0xff8m.world+'_'+_0x009n;var _0x221p=localStorage.getItem(_0x110o);if(_0x221p){_0xff8m.playerName=_0x221p;}}await _0x332q(_0x007j,_0xff8m);console.log('Auto-send completed successfully');}catch(_0x443r){console.error('Auto-send error:',_0x443r);localStorage.removeItem(_0x996s);localStorage.removeItem('tw_last_auto_send');localStorage.removeItem('tw_last_auto_send_time');}finally{try{var _0x554s=localStorage.getItem(_0xaa7t);if(_0x554s){var _0x665t=JSON.parse(_0x554s);if(_0x665t.nonce===_0x225z){localStorage.removeItem(_0xaa7t);}}var _0x776u=localStorage.getItem(_0xbb8u);if(_0x776u){var _0x887v=JSON.parse(_0x776u);if(_0x887v.nonce===_0x225z){localStorage.removeItem(_0xbb8u);}}}catch(_0x998w){}}};var _0xaa9x=new Date();var _0xbb0y=_0xaa9x.getMinutes();var _0xcc1z=_0xaa9x.getSeconds();var _0xdd2a=_0xaa9x.getMilliseconds();var _0xee3b=Math.ceil(_0xbb0y/10)*10;var _0xff4c=(_0xee3b-_0xbb0y)%60;var _0x005d=(_0xff4c*60-_0xcc1z)*1000-_0xdd2a;setTimeout(function(){_0x441n();setInterval(_0x441n,600000);},_0x005d);}async function _0x332q(_0x116e,_0x227f){return new Promise(function(_0x338g,_0x449h){var _0x550i=Date.now();var _0x661j=false;var _0x772k=setTimeout(function(){if(!_0x661j){_0x661j=true;_0x449h(new Error('Discord send timeout after 30 seconds'));}},30000);_0x5g6h(_0x116e,_0x227f,{innerHTML:function(_0x883l){if(_0x661j)return;if(_0x883l.includes('Successfully')){_0x661j=true;clearTimeout(_0x772k);_0x338g();}else if(_0x883l.includes('Error')||_0x883l.includes('Failed')){_0x661j=true;clearTimeout(_0x772k);_0x449h(new Error(_0x883l));}}});});}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',function(){_0x3c4d();_0x5i6j();});}else{_0x3c4d();_0x5i6j();}})();
